<h2 class="form-title">💳 Payment Management</h2>

<!-- Payment Form -->
<form [formGroup]="paymentForm" (ngSubmit)="onSubmit()" class="payment-form">
  <div>
    <label>Transaction ID</label>
    <input type="number" formControlName="transactionId" placeholder="Enter transaction ID" />
  </div>

  <div>
    <label>Payment Method</label>
    <select formControlName="method">
      <option value="">Select method</option>
      <option value="UPI">UPI</option>
      <option value="CARD">Card</option>
      <option value="NETBANKING">Net Banking</option>
    </select>
  </div>

  <div>
    <label>Amount</label>
    <input type="number" formControlName="amount" placeholder="Enter amount" />
  </div>

  <div>
    <label>Currency</label>
    <input type="text" formControlName="currency" placeholder="Enter currency (e.g. INR, USD)" />
  </div>

  <div>
    <label>Status</label>
    <select formControlName="status">
      <option value="PENDING">Pending</option>
      <option value="SUCCESS">Success</option>
      <option value="FAILED">Failed</option>
    </select>
  </div>

  <div>
    <label>External Reference ID</label>
    <input type="text" formControlName="externalReferenceId" placeholder="Enter external reference ID" />
  </div>

  <div>
    <label>Failure Reason</label>
    <input type="text" formControlName="failureReason" placeholder="Enter reason if failed" />
  </div>

  <button type="submit" [disabled]="paymentForm.invalid" class="btn btn-primary">Add Payment</button>
</form>

<hr />

<!-- Search Payment -->
<h2 class="form-title">🔍 Search Payment</h2>
<form (ngSubmit)="searchPayment()">
  <input type="number" [(ngModel)]="searchId" name="searchId" placeholder="Enter Payment ID" />
  <button type="submit" class="btn btn-secondary">Search</button>
  <button type="button" (click)="clearSearch()" class="btn btn-danger">Clear</button>
</form>

<!-- Selected Payment -->
<div *ngIf="selectedPayment" class="selected-details">
  <h3>📑 Payment Details</h3>
  <p><strong>ID:</strong> {{ selectedPayment.paymentId }}</p>
  <p><strong>Transaction:</strong> {{ selectedPayment.transactionId }}</p>
  <p><strong>Method:</strong> {{ selectedPayment.method }}</p>
  <p><strong>Amount:</strong> ₹ {{ selectedPayment.amount | number:'1.2-2' }}</p>
  <p><strong>Status:</strong> {{ selectedPayment.status }}</p>
</div>

<hr />

<!-- Payment List -->
<h2 class="form-title">📋 All Payments</h2>
<table class="payment-table" *ngIf="payments.length > 0">
  <thead>
    <tr>
      <th>ID</th>
      <th>Transaction ID</th>
      <th>Method</th>
      <th>Amount</th>
      <th>Currency</th>
      <th>Status</th>
      <th>External Ref ID</th>
      <th>Failure Reason</th>
      <th>Created</th>
      <th>Updated</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let p of payments">
      <td>{{ p.paymentId }}</td>
      <td>{{ p.transactionId }}</td>
      <td>{{ p.method }}</td>
      <td>₹ {{ p.amount | number:'1.2-2' }}</td>
      <td>{{ p.currency }}</td>
      <td>{{ p.status }}</td>
      <td>{{ p.externalReferenceId }}</td>
      <td>{{ p.failureReason }}</td>
      <td>{{ p.createdAt | date:'short' }}</td>
      <td>{{ p.updatedAt | date:'short' }}</td>
      <td>
        <button (click)="viewPayment(p)">View</button>
        <button (click)="deletePayment(p.paymentId)">Delete</button>
        <button (click)="patchPayment(p.paymentId, 'SUCCESS')">Mark Success</button>
        <button (click)="patchPayment(p.paymentId, 'FAILED')">Mark Failed</button>
      </td>
    </tr>
  </tbody>
</table>

